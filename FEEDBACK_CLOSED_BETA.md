# mamane ã‚¯ãƒ­ãƒ¼ã‚ºãƒ‰Î²ç‰ˆã«å‘ã‘ãŸãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯

**ä½œæˆæ—¥**: 2025-12-19
**å¯¾è±¡**: mamane v0.1.0
**æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯**: Next.js 14, Supabase, TailwindCSS, Framer Motion

---

## ã‚µãƒãƒªãƒ¼

| ã‚«ãƒ†ã‚´ãƒª | é‡å¤§ | é«˜ | ä¸­ | ä½ |
|---------|------|----|----|-----|
| æ©Ÿèƒ½ | 1 | 4 | 6 | 3 |
| æ€§èƒ½ | 0 | 2 | 4 | 2 |
| ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ | 2 | 3 | 2 | 1 |

---

## 1. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

### ğŸ”´ é‡å¤§ (Critical)

#### 1.1 SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã®å¯èƒ½æ€§
**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/app/(main)/search/page.tsx:50`

```typescript
.or(`title.ilike.%${query}%,content.ilike.%${query}%`)
```

**å•é¡Œ**: ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã®`query`ãŒç›´æ¥SQLã‚¯ã‚¨ãƒªã«åŸ‹ã‚è¾¼ã¾ã‚Œã¦ã„ã‚‹ã€‚ç‰¹æ®Šæ–‡å­—ï¼ˆ`%`, `_`, `'`ãªã©ï¼‰ãŒã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã•ã‚Œã¦ã„ãªã„ã€‚

**æ¨å¥¨å¯¾ç­–**:
```typescript
// ç‰¹æ®Šæ–‡å­—ã‚’ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã™ã‚‹é–¢æ•°ã‚’ä½œæˆ
function escapeForIlike(str: string): string {
  return str.replace(/[%_\\]/g, '\\$&');
}

const escapedQuery = escapeForIlike(query);
.or(`title.ilike.%${escapedQuery}%,content.ilike.%${escapedQuery}%`)
```

#### 1.2 ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§ã®èªå¯ãƒã‚§ãƒƒã‚¯ä¸è¶³
**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/components/trivia/DeleteButton.tsx`

**å•é¡Œ**: å‰Šé™¤ãƒœã‚¿ãƒ³ã®è¡¨ç¤º/éè¡¨ç¤ºã¯ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§åˆ¶å¾¡ã•ã‚Œã¦ã„ã‚‹ãŒã€å®Ÿéš›ã®å‰Šé™¤å‡¦ç†ã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ç›´æ¥Supabaseã«é€ä¿¡ã•ã‚Œã‚‹ã€‚RLSï¼ˆRow Level Securityï¼‰ãŒé©åˆ‡ã«è¨­å®šã•ã‚Œã¦ã„ãªã„å ´åˆã€ä»–äººã®æŠ•ç¨¿ã‚’å‰Šé™¤ã§ãã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã€‚

**æ¨å¥¨å¯¾ç­–**:
1. Supabaseã§é©åˆ‡ãªRLSãƒãƒªã‚·ãƒ¼ã‚’è¨­å®š
2. ã¾ãŸã¯Server Actionsã‚’ä½¿ç”¨ã—ã¦ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§èªå¯ãƒã‚§ãƒƒã‚¯

```sql
-- Supabase RLSä¾‹
CREATE POLICY "Users can delete own trivia" ON trivia
  FOR DELETE USING (auth.uid() = user_id);
```

---

### ğŸŸ  é«˜ (High)

#### 1.3 Rate Limitingã®æ¬ å¦‚
**å•é¡Œ**: APIå‘¼ã³å‡ºã—ã«å¯¾ã™ã‚‹ãƒ¬ãƒ¼ãƒˆåˆ¶é™ãŒãªã„ã€‚ä»¥ä¸‹ã®æ”»æ’ƒã«å¯¾ã—ã¦è„†å¼±:
- ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹æ”»æ’ƒï¼ˆãƒ­ã‚°ã‚¤ãƒ³ï¼‰
- ã‚¹ãƒ‘ãƒ æŠ•ç¨¿
- ã€Œãƒ©ãƒƒã‚·ãƒ£ãƒ¼ã€ã®é€£æ‰“

**æ¨å¥¨å¯¾ç­–**:
```typescript
// next.config.mjs ã§Rate Limitingã‚’è¨­å®š
// ã¾ãŸã¯ Vercel Edge Functionsã‚’ä½¿ç”¨
// ã¾ãŸã¯ upstash/ratelimit ã‚’å°å…¥
```

#### 1.4 ç’°å¢ƒå¤‰æ•°ã®énull assertion
**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/lib/supabase/client.ts`, `server.ts`, `middleware.ts`

```typescript
process.env.NEXT_PUBLIC_SUPABASE_URL!
process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
```

**å•é¡Œ**: ç’°å¢ƒå¤‰æ•°ãŒè¨­å®šã•ã‚Œã¦ã„ãªã„å ´åˆã€å®Ÿè¡Œæ™‚ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã€‚

**æ¨å¥¨å¯¾ç­–**:
```typescript
const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;
const supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;

if (!supabaseUrl || !supabaseAnonKey) {
  throw new Error('Missing Supabase environment variables');
}
```

#### 1.5 XSSå¯¾ç­–ã®ç¢ºèª
**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/components/comment/CommentList.tsx:45`

```tsx
<p className="text-gray-700 whitespace-pre-wrap break-words">
  {comment.content}
</p>
```

**å•é¡Œ**: Reactã¯åŸºæœ¬çš„ã«XSSã‚’é˜²ããŒã€`whitespace-pre-wrap`ã¨çµ„ã¿åˆã‚ã›ãŸå ´åˆã®ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã‚’ç¢ºèªã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚

**æ¨å¥¨å¯¾ç­–**:
- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ã‚µãƒ‹ã‚¿ã‚¤ã‚ºã‚’æ¤œè¨
- Content Security Policy (CSP) ã®è¨­å®š

---

### ğŸŸ¡ ä¸­ (Medium)

#### 1.6 CSRFå¯¾ç­–
**å•é¡Œ**: Supabase SSRã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ãŒã€æ˜ç¤ºçš„ãªCSRFãƒˆãƒ¼ã‚¯ãƒ³ã®æ¤œè¨¼ãŒãªã„ã€‚

**æ¨å¥¨å¯¾ç­–**: Next.js 14ã§ã¯Server Actionsã‚’ä½¿ç”¨ã™ã‚‹ã¨è‡ªå‹•çš„ã«CSRFå¯¾ç­–ãŒè¡Œã‚ã‚Œã‚‹ã€‚

#### 1.7 ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/lib/supabase/server.ts`

**å•é¡Œ**: Cookieè¨­å®šã§try-catchã§ä¾‹å¤–ã‚’æ¡ã‚Šã¤ã¶ã—ã¦ã„ã‚‹ã€‚

```typescript
} catch {
  // Server Componentã‹ã‚‰ã®å‘¼ã³å‡ºã—æ™‚ã¯ç„¡è¦–
}
```

---

### ğŸŸ¢ ä½ (Low)

#### 1.8 ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æƒ…å ±æ¼æ´©
**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/app/(auth)/login/page.tsx:28`

```typescript
setError("ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé–“é•ã£ã¦ã„ã¾ã™");
```

**è©•ä¾¡**: é©åˆ‡ã€‚å€‹åˆ¥ã«ã€Œãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒå­˜åœ¨ã—ã¾ã›ã‚“ã€ãªã©ã¨è¡¨ç¤ºã—ãªã„ã®ã¯è‰¯ã„å¯¾ç­–ã€‚

---

## 2. æ©Ÿèƒ½

### ğŸ”´ é‡å¤§ (Critical)

#### 2.1 è±†çŸ¥è­˜æŠ•ç¨¿æ™‚ã«ã‚«ãƒ†ã‚´ãƒªã‚’é¸æŠã§ããªã„
**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/app/(main)/trivia/new/page.tsx`

**å•é¡Œ**: æŠ•ç¨¿ãƒ•ã‚©ãƒ¼ãƒ ã«ã‚«ãƒ†ã‚´ãƒªé¸æŠUIãŒãªã„ã€‚ã‚«ãƒ†ã‚´ãƒªæ©Ÿèƒ½ãŒå­˜åœ¨ã™ã‚‹ã®ã«ä½¿ã‚ã‚Œã¦ã„ãªã„ã€‚

**æ¨å¥¨å¯¾ç­–**:
```tsx
// ã‚«ãƒ†ã‚´ãƒªé¸æŠUIã‚’è¿½åŠ 
<select value={categoryId} onChange={(e) => setCategoryId(e.target.value)}>
  <option value="">ã‚«ãƒ†ã‚´ãƒªã‚’é¸æŠ</option>
  {categories.map(cat => (
    <option key={cat.id} value={cat.id}>{cat.icon} {cat.name}</option>
  ))}
</select>
```

---

### ğŸŸ  é«˜ (High)

#### 2.2 ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³/ç„¡é™ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãŒãªã„
**ãƒ•ã‚¡ã‚¤ãƒ«**: è¤‡æ•°ãƒšãƒ¼ã‚¸ï¼ˆ`page.tsx`, `ranking/page.tsx`, `search/page.tsx`ï¼‰

**å•é¡Œ**: ã™ã¹ã¦ã®ãƒšãƒ¼ã‚¸ã§`.limit(20)`ã§å›ºå®šã•ã‚Œã¦ãŠã‚Šã€ãã‚Œä»¥ä¸Šã®ãƒ‡ãƒ¼ã‚¿ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„ã€‚

**æ¨å¥¨å¯¾ç­–**:
- ã‚«ãƒ¼ã‚½ãƒ«ãƒ™ãƒ¼ã‚¹ã®ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³
- ã¾ãŸã¯ç„¡é™ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ï¼ˆIntersection Observerï¼‰

#### 2.3 ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½ãŒãªã„
**å•é¡Œ**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¿˜ã‚ŒãŸå ´åˆã®å›å¾©æ‰‹æ®µãŒãªã„ã€‚

**æ¨å¥¨å¯¾ç­–**:
```typescript
// Supabaseã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½ã‚’å®Ÿè£…
await supabase.auth.resetPasswordForEmail(email, {
  redirectTo: `${origin}/auth/reset-password`,
});
```

#### 2.4 ãƒ¡ãƒ¼ãƒ«ç¢ºèªãƒ•ãƒ­ãƒ¼ãŒãªã„
**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/app/(auth)/signup/page.tsx`

**å•é¡Œ**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²å¾Œã€ãƒ¡ãƒ¼ãƒ«ç¢ºèªãªã—ã§ãã®ã¾ã¾ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã«ãªã‚‹ã€‚

**æ¨å¥¨å¯¾ç­–**: Supabaseã®ãƒ¡ãƒ¼ãƒ«ç¢ºèªæ©Ÿèƒ½ã‚’æœ‰åŠ¹ã«ã—ã€ç¢ºèªå®Œäº†ãƒšãƒ¼ã‚¸ã‚’ä½œæˆã€‚

#### 2.5 ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã«æŠ•ç¨¿ä¸€è¦§ãŒãªã„
**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/app/(main)/user/[id]/page.tsx`

**å•é¡Œ**: ãƒã‚¤ãƒšãƒ¼ã‚¸ã«ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æƒ…å ±ã®ã¿è¡¨ç¤ºã•ã‚Œã€æŠ•ç¨¿ã—ãŸè±†çŸ¥è­˜ä¸€è¦§ãŒãªã„ã€‚

---

### ğŸŸ¡ ä¸­ (Medium)

#### 2.6 ã‚³ãƒ¡ãƒ³ãƒˆã®ç·¨é›†ãƒ»å‰Šé™¤æ©Ÿèƒ½ãŒãªã„
**å•é¡Œ**: ä¸€åº¦æŠ•ç¨¿ã—ãŸã‚³ãƒ¡ãƒ³ãƒˆã‚’ç·¨é›†ãƒ»å‰Šé™¤ã§ããªã„ã€‚

#### 2.7 é€šçŸ¥æ©Ÿèƒ½ãŒãªã„
**å•é¡Œ**: è‡ªåˆ†ã®æŠ•ç¨¿ã«ã€Œãƒ©ãƒƒã‚·ãƒ£ãƒ¼ã€ã‚„ã‚³ãƒ¡ãƒ³ãƒˆãŒã¤ã„ã¦ã‚‚é€šçŸ¥ã•ã‚Œãªã„ã€‚

#### 2.8 ã‚½ãƒ¼ãƒˆæ©Ÿèƒ½ãŒé™å®šçš„
**å•é¡Œ**:
- ãƒ›ãƒ¼ãƒ : æ–°ç€é †ã®ã¿
- ãƒ©ãƒ³ã‚­ãƒ³ã‚°: ã¸ã‡æ•°é †ã®ã¿
- æ¤œç´¢: ã¸ã‡æ•°é †ã®ã¿

æœŸé–“æŒ‡å®šï¼ˆä»Šæ—¥ã€é€±é–“ã€æœˆé–“ï¼‰ãªã©ãŒãªã„ã€‚

#### 2.9 ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½ãŒãªã„
**å•é¡Œ**: `avatar_url`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯å­˜åœ¨ã™ã‚‹ãŒã€ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰UIãŒãªã„ã€‚

#### 2.10 è‡ªåˆ†ã®æŠ•ç¨¿ã¸ã®ã€Œãƒ©ãƒƒã‚·ãƒ£ãƒ¼ã€ãŒå¯èƒ½
**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/components/trivia/HeeButton.tsx`

**å•é¡Œ**: è‡ªåˆ†ã®æŠ•ç¨¿ã«ã‚‚ã€Œãƒ©ãƒƒã‚·ãƒ£ãƒ¼ã€ã§ãã¦ã—ã¾ã†ï¼ˆè‡ªä½œè‡ªæ¼”ãŒå¯èƒ½ï¼‰ã€‚

#### 2.11 ä¸‹æ›¸ãä¿å­˜æ©Ÿèƒ½ãŒãªã„
**å•é¡Œ**: æŠ•ç¨¿é€”ä¸­ã§ãƒšãƒ¼ã‚¸ã‚’é›¢ã‚Œã‚‹ã¨å†…å®¹ãŒæ¶ˆãˆã‚‹ã€‚

---

### ğŸŸ¢ ä½ (Low)

#### 2.12 ã‚½ãƒ¼ã‚·ãƒ£ãƒ«ãƒ­ã‚°ã‚¤ãƒ³ãŒãªã„
**å•é¡Œ**: ãƒ¡ãƒ¼ãƒ«/ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ã¿ã€‚Google, Twitterç­‰ã®ã‚½ãƒ¼ã‚·ãƒ£ãƒ«ãƒ­ã‚°ã‚¤ãƒ³ãŒã‚ã‚‹ã¨ä¾¿åˆ©ã€‚

#### 2.13 è±†çŸ¥è­˜ã®ç·¨é›†æ©Ÿèƒ½ãŒãªã„
**å•é¡Œ**: æŠ•ç¨¿å¾Œã®ç·¨é›†ãŒã§ããªã„ï¼ˆå‰Šé™¤ã®ã¿ï¼‰ã€‚

#### 2.14 å…±æœ‰æ©Ÿèƒ½ãŒãªã„
**å•é¡Œ**: SNSã¸ã®å…±æœ‰ãƒœã‚¿ãƒ³ãŒãªã„ã€‚

---

## 3. æ€§èƒ½

### ğŸŸ  é«˜ (High)

#### 3.1 N+1ã‚¯ã‚¨ãƒªãƒ‘ã‚¿ãƒ¼ãƒ³
**ãƒ•ã‚¡ã‚¤ãƒ«**: è¤‡æ•°ãƒšãƒ¼ã‚¸

**å•é¡Œ**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’åˆ¥ã‚¯ã‚¨ãƒªã§å–å¾—ã—ã¦ã„ã‚‹ã€‚

```typescript
// è±†çŸ¥è­˜å–å¾—
const { data: triviaData } = await supabase.from("trivia")...

// åˆ¥ã‚¯ã‚¨ãƒªã§ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³å–å¾—
const { data: reactions } = await supabase
  .from("hee_reactions")
  .select("trivia_id")
  .eq("user_id", user.id);
```

**æ¨å¥¨å¯¾ç­–**:
- ãƒ“ãƒ¥ãƒ¼ã‚’ä½œæˆã—ã¦1å›ã®ã‚¯ã‚¨ãƒªã§å–å¾—
- ã¾ãŸã¯ã‚µãƒ–ã‚¯ã‚¨ãƒªã‚’ä½¿ç”¨

#### 3.2 ã‚³ãƒ¡ãƒ³ãƒˆæ•°ã®å–å¾—æ–¹æ³•
**ãƒ•ã‚¡ã‚¤ãƒ«**: è¤‡æ•°ãƒšãƒ¼ã‚¸

```typescript
comments (
  id
)
// ...
comment_count: item.comments?.length || 0,
```

**å•é¡Œ**: å…¨ã‚³ãƒ¡ãƒ³ãƒˆã‚’å–å¾—ã—ã¦ã‹ã‚‰lengthã‚’æ•°ãˆã¦ã„ã‚‹ã€‚

**æ¨å¥¨å¯¾ç­–**:
```sql
-- Supabaseã§ã‚«ã‚¦ãƒ³ãƒˆç”¨ã®ãƒ“ãƒ¥ãƒ¼ã‚’ä½œæˆ
SELECT trivia.*, COUNT(comments.id) as comment_count
FROM trivia
LEFT JOIN comments ON comments.trivia_id = trivia.id
GROUP BY trivia.id;
```

---

### ğŸŸ¡ ä¸­ (Medium)

#### 3.3 ç”»åƒæœ€é©åŒ–è¨­å®šãŒãªã„
**ãƒ•ã‚¡ã‚¤ãƒ«**: `next.config.mjs`

```javascript
const nextConfig = {};
```

**æ¨å¥¨å¯¾ç­–**:
```javascript
const nextConfig = {
  images: {
    remotePatterns: [
      { protocol: 'https', hostname: '*.supabase.co' },
    ],
    formats: ['image/avif', 'image/webp'],
  },
};
```

#### 3.4 ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥ãŒãªã„
**å•é¡Œ**: `revalidate`è¨­å®šãŒãªãã€ã™ã¹ã¦ã®ãƒšãƒ¼ã‚¸ãŒãƒªã‚¯ã‚¨ã‚¹ãƒˆã”ã¨ã«å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã‚‹ã€‚

**æ¨å¥¨å¯¾ç­–**:
```typescript
// ãƒšãƒ¼ã‚¸ã«è¿½åŠ 
export const revalidate = 60; // 60ç§’ã‚­ãƒ£ãƒƒã‚·ãƒ¥
```

#### 3.5 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®ç¢ºèª
**å•é¡Œ**: ä»¥ä¸‹ã®ã‚«ãƒ©ãƒ ã«ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãŒå¿…è¦:
- `trivia.created_at`
- `trivia.hee_count`
- `trivia.category_id`
- `hee_reactions.user_id, trivia_id` (è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹)
- `comments.trivia_id`

#### 3.6 ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºã®æœ€é©åŒ–
**å•é¡Œ**:
- `framer-motion`: å¤§ããªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã ãŒå…¨ä½“ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
- `date-fns`: tree-shakingã¯åŠ¹ããŒç¢ºèªãŒå¿…è¦

---

### ğŸŸ¢ ä½ (Low)

#### 3.7 Suspenseã®æœªä½¿ç”¨
**å•é¡Œ**: ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã®ç®¡ç†ã«Suspenseã‚’ä½¿ç”¨ã—ã¦ã„ãªã„ã€‚

#### 3.8 ãƒ—ãƒªãƒ•ã‚§ãƒƒãƒã®æœªæ´»ç”¨
**å•é¡Œ**: Linkã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®prefetchæ©Ÿèƒ½ã‚’æ˜ç¤ºçš„ã«æ´»ç”¨ã—ã¦ã„ãªã„ã€‚

---

## 4. ã‚³ãƒ¼ãƒ‰å“è³ªãƒ»ä¿å®ˆæ€§

### ğŸŸ¡ ä¸­ (Medium)

#### 4.1 å‹ã®`any`ä½¿ç”¨
**ãƒ•ã‚¡ã‚¤ãƒ«**: è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«

```typescript
const triviaList: TriviaWithDetails[] = (triviaData || []).map((item: any) => ({
```

**æ¨å¥¨å¯¾ç­–**: Supabaseã®å‹ç”Ÿæˆæ©Ÿèƒ½ã‚’ä½¿ç”¨ã—ã¦é©åˆ‡ãªå‹ã‚’å®šç¾©ã€‚

```bash
npx supabase gen types typescript --project-id your-project-id > src/types/supabase.ts
```

#### 4.2 é‡è¤‡ã‚³ãƒ¼ãƒ‰
**å•é¡Œ**: è±†çŸ¥è­˜ä¸€è¦§å–å¾—ã®ã‚¯ã‚¨ãƒªãŒã»ã¼åŒã˜å†…å®¹ã§è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã«å­˜åœ¨ã€‚

**æ¨å¥¨å¯¾ç­–**: å…±é€šé–¢æ•°ã‚’`src/lib/queries.ts`ã«æŠ½å‡ºã€‚

```typescript
export async function getTriviaList(supabase: SupabaseClient, options?: {
  categoryId?: string;
  orderBy?: 'created_at' | 'hee_count';
  limit?: number;
}) {
  // å…±é€šãƒ­ã‚¸ãƒƒã‚¯
}
```

#### 4.3 ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®ä¸€è²«æ€§
**å•é¡Œ**: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒå„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ãƒãƒ©ãƒãƒ©ã€‚

---

## 5. UX/ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£

### ğŸŸ¡ ä¸­ (Medium)

#### 5.1 ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã®ä¸çµ±ä¸€
**å•é¡Œ**: ä¸€éƒ¨ã¯Loaderã‚¢ã‚¤ã‚³ãƒ³ã€ä¸€éƒ¨ã¯ä½•ã‚‚è¡¨ç¤ºã•ã‚Œãªã„ã€‚

#### 5.2 ã‚¨ãƒ©ãƒ¼çŠ¶æ…‹ã®ä¸çµ±ä¸€
**å•é¡Œ**: ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã‚¹ã‚¿ã‚¤ãƒ«ãŒãƒšãƒ¼ã‚¸ã«ã‚ˆã£ã¦ç•°ãªã‚‹ã€‚

#### 5.3 ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³
**å•é¡Œ**: ãƒ•ã‚©ãƒ¼ã‚«ã‚¹çŠ¶æ…‹ã®ã‚¹ã‚¿ã‚¤ãƒ«ãŒä¸ååˆ†ãªç®‡æ‰€ãŒã‚ã‚‹ã€‚

#### 5.4 ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒªãƒ¼ãƒ€ãƒ¼å¯¾å¿œ
**å•é¡Œ**:
- aria-label ã®ä¸è¶³
- ãƒœã‚¿ãƒ³ã®èª¬æ˜ä¸è¶³
- ãƒ©ã‚¤ãƒ–ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã®æœªä½¿ç”¨

---

## 6. æ¨å¥¨ã•ã‚Œã‚‹å„ªå…ˆå¯¾å¿œ

### Phase 1: ã‚¯ãƒ­ãƒ¼ã‚ºãƒ‰Î²å‰ï¼ˆå¿…é ˆï¼‰
1. âœ… SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯¾ç­–ï¼ˆæ¤œç´¢æ©Ÿèƒ½ï¼‰
2. âœ… RLSãƒãƒªã‚·ãƒ¼ã®è¨­å®šãƒ»ç¢ºèª
3. âœ… ã‚«ãƒ†ã‚´ãƒªé¸æŠæ©Ÿèƒ½ã®å®Ÿè£…
4. âœ… Rate Limitingã®å°å…¥

### Phase 2: ã‚¯ãƒ­ãƒ¼ã‚ºãƒ‰Î²ä¸­
1. ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³/ç„¡é™ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
2. ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½
3. N+1ã‚¯ã‚¨ãƒªã®æœ€é©åŒ–
4. è‡ªåˆ†ã¸ã®ã€Œãƒ©ãƒƒã‚·ãƒ£ãƒ¼ã€é˜²æ­¢

### Phase 3: æ­£å¼ãƒªãƒªãƒ¼ã‚¹å‰
1. é€šçŸ¥æ©Ÿèƒ½
2. ã‚½ãƒ¼ã‚·ãƒ£ãƒ«ãƒ­ã‚°ã‚¤ãƒ³
3. ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
4. PWAå¯¾å¿œ

---

## ä»˜éŒ²: è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®æ¨å¥¨å¤‰æ›´

### next.config.mjs
```javascript
/** @type {import('next').NextConfig} */
const nextConfig = {
  images: {
    remotePatterns: [
      {
        protocol: 'https',
        hostname: '*.supabase.co',
      },
    ],
  },
  experimental: {
    serverActions: {
      bodySizeLimit: '2mb',
    },
  },
  headers: async () => [
    {
      source: '/(.*)',
      headers: [
        {
          key: 'X-Content-Type-Options',
          value: 'nosniff',
        },
        {
          key: 'X-Frame-Options',
          value: 'DENY',
        },
        {
          key: 'X-XSS-Protection',
          value: '1; mode=block',
        },
      ],
    },
  ],
};

export default nextConfig;
```

---

*ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯å®šæœŸçš„ã«æ›´æ–°ã—ã¦ãã ã•ã„ã€‚*
